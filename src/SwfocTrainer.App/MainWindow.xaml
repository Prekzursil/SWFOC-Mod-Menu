<Window x:Class="SwfocTrainer.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="SWFOC Trainer Editor" Height="900" Width="1400"
        MinWidth="1024" MinHeight="700"
        Background="#111822"
        Foreground="#E6EDF7">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
            <TextBlock Text="Profile:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox Width="320" ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfileId}"/>
            <Button Content="Load Profiles" Command="{Binding LoadProfilesCommand}" Margin="8,0,0,0"/>
            <Button Content="Load Actions" Command="{Binding LoadActionsCommand}" Margin="8,0,0,0"/>
            <Button Content="Attach" Command="{Binding AttachCommand}" Margin="8,0,0,0"/>
            <Button Content="Detach" Command="{Binding DetachCommand}" Margin="8,0,0,0"/>
            <TextBlock Text="  Mode:" VerticalAlignment="Center" Margin="12,0,4,0"/>
            <TextBlock Text="{Binding RuntimeMode}" VerticalAlignment="Center"/>
            <TextBlock Text="  Symbols:" VerticalAlignment="Center" Margin="12,0,4,0"/>
            <TextBlock Text="{Binding ResolvedSymbolsCount}" VerticalAlignment="Center"/>
        </StackPanel>

        <TabControl Grid.Row="1" Background="#182132" BorderThickness="0">
            <TabItem Header="Runtime">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Action:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox Width="380" ItemsSource="{Binding Actions}" SelectedItem="{Binding SelectedActionId}"/>
                        <Button Content="Execute" Command="{Binding ExecuteActionCommand}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <!-- Quick-Action Buttons -->
                    <GroupBox Header="Quick Actions" Grid.Row="1" Margin="0,10,0,0" Padding="6">
                        <StackPanel>
                            <!-- Credits row: value input + freeze toggle + set button -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="ðŸ’° Credits:" VerticalAlignment="Center" Margin="4,0,6,0"/>
                                <TextBox Text="{Binding CreditsValue, UpdateSourceTrigger=PropertyChanged}" Width="110" VerticalAlignment="Center" Padding="4,2"/>
                                <CheckBox Content="Freeze" IsChecked="{Binding CreditsFreeze}" VerticalAlignment="Center" Margin="8,0,8,0"/>
                                <Button Content="Set Credits" Command="{Binding QuickSetCreditsCommand}" Padding="8,4"/>
                            </StackPanel>
                            <WrapPanel>
                                <Button Content="â±ï¸ Freeze Timer" Command="{Binding QuickFreezeTimerCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="ðŸ—ºï¸ Toggle Fog" Command="{Binding QuickToggleFogCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="ðŸ¤– Toggle AI" Command="{Binding QuickToggleAiCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="âš¡ Instant Build Patch" Command="{Binding QuickInstantBuildCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="ðŸ—ï¸ Unit Cap 99k" Command="{Binding QuickUnitCapCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="ðŸ›¡ï¸ God Mode" Command="{Binding QuickGodModeCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="ðŸ’¥ One Hit Kill" Command="{Binding QuickOneHitCommand}" Margin="2" Padding="8,4"/>
                                <Button Content="ðŸ”“ Unfreeze All" Command="{Binding QuickUnfreezeAllCommand}" Margin="2" Padding="8,4"/>
                            </WrapPanel>
                        </StackPanel>
                    </GroupBox>

                    <Grid Grid.Row="2" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <GroupBox Header="Payload JSON" Margin="0,0,8,0">
                            <TextBox Text="{Binding PayloadJson}" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"/>
                        </GroupBox>

                        <Grid Grid.Column="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Active Freezes Panel -->
                            <GroupBox Header="Active Freezes" Margin="0,0,0,8">
                                <ListBox ItemsSource="{Binding ActiveFreezes}" Height="80" FontFamily="Consolas" FontSize="11"/>
                            </GroupBox>

                            <GroupBox Header="Catalog, Helper &amp; Hotkeys" Grid.Row="1">
                                <Grid Margin="8">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="Load Catalog" Command="{Binding LoadCatalogCommand}"/>
                                        <Button Content="Deploy Helper" Command="{Binding DeployHelperCommand}" Margin="8,0,0,0"/>
                                        <Button Content="Verify Helper" Command="{Binding VerifyHelperCommand}" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    <ListBox Grid.Row="1" ItemsSource="{Binding CatalogSummary}" Margin="0,8,0,0" Height="100"/>
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,0">
                                        <Button Content="Load Hotkeys" Command="{Binding LoadHotkeysCommand}"/>
                                        <Button Content="Save Hotkeys" Command="{Binding SaveHotkeysCommand}" Margin="8,0,0,0"/>
                                        <Button Content="Add" Command="{Binding AddHotkeyCommand}" Margin="8,0,0,0"/>
                                        <Button Content="Remove" Command="{Binding RemoveHotkeyCommand}" Margin="8,0,0,0"/>
                                    </StackPanel>
                                    <DataGrid Grid.Row="3"
                                              ItemsSource="{Binding Hotkeys}"
                                              SelectedItem="{Binding SelectedHotkey}"
                                              AutoGenerateColumns="False"
                                              CanUserAddRows="False"
                                              Margin="0,8,0,0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Gesture" Binding="{Binding Gesture}" Width="*"/>
                                            <DataGridTextColumn Header="Action" Binding="{Binding ActionId}" Width="*"/>
                                            <DataGridTextColumn Header="Payload JSON" Binding="{Binding PayloadJson}" Width="2*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="Save Editor">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Save:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Text="{Binding SavePath}" Width="760"/>
                        <Button Content="Browse" Command="{Binding BrowseSaveCommand}" Margin="8,0,0,0"/>
                        <Button Content="Load" Command="{Binding LoadSaveCommand}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,10,0,0">
                        <TextBlock Text="Node Path:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Text="{Binding SaveNodePath}" Width="360"/>
                        <TextBlock Text="Value:" VerticalAlignment="Center" Margin="12,0,8,0"/>
                        <TextBox Text="{Binding SaveEditValue}" Width="180"/>
                        <Button Content="Edit" Command="{Binding EditSaveCommand}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,10,0,0">
                        <Button Content="Validate" Command="{Binding ValidateSaveCommand}"/>
                        <Button Content="Preview Diff" Command="{Binding RefreshDiffCommand}" Margin="8,0,0,0"/>
                        <Button Content="Write Edited Save" Command="{Binding WriteSaveCommand}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <Grid Grid.Row="3" Margin="0,16,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock TextWrapping="Wrap"
                                   Text="Full save schema editing is profile-driven. Use field ids or schema paths in Node Path. Diff preview lists changed offsets before save write."/>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Text="{Binding SaveSearchQuery, UpdateSourceTrigger=PropertyChanged}" Width="320"/>
                        </StackPanel>
                        <Grid Grid.Row="2" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <DataGrid ItemsSource="{Binding FilteredSaveFields}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      Margin="0,0,8,0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Path" Binding="{Binding Path}" Width="2*"/>
                                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                    <DataGridTextColumn Header="Type" Binding="{Binding ValueType}" Width="*"/>
                                    <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <ListBox Grid.Column="1" ItemsSource="{Binding SaveDiffPreview}"/>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="Profiles &amp; Updates">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <Button Content="Check Updates" Command="{Binding CheckUpdatesCommand}"/>
                        <Button Content="Install Selected Profile" Command="{Binding InstallUpdateCommand}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <ListBox Grid.Row="1" ItemsSource="{Binding Updates}" Margin="0,12,0,0"/>
                </Grid>
            </TabItem>
        </TabControl>

        <Border Grid.Row="2" Background="#0D1422" BorderBrush="#2E3E5C" BorderThickness="1" Padding="10" Margin="0,12,0,0">
            <TextBlock Text="{Binding Status}"/>
        </Border>
    </Grid>
</Window>
